<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Metro Engine</title>
    <meta content="Metro Engine is a C++ / C / LUA graphics engine that is able to run on PC and Playstation 4 with an excellent performance. IBL, PBR, Shadow Mapping, OpenGL" name="description">
    <meta content="IBL, PBR, Shadow Mapping, OpenGL, Ps4, Playstation, graphics, engine, C, C++" name="keywords">

    <!-- Favicons -->
    <link href="img/favicon.png" rel="icon">
    <link href="img/favicon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <!--<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,500,600,700|Raleway:400,400i,500,500i,600,600i,700,700i&display=swap" rel="stylesheet">-->
    <!-- Vendor CSS Files -->
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet">

    <!-- =======================================================
    * Template Name: MyPortfolio - v4.3.0
    * Template URL: https://bootstrapmade.com/myportfolio-bootstrap-portfolio-website-template/
    * Author: BootstrapMade.com
    * License: https://bootstrapmade.com/license/
    ======================================================== -->
</head>

<body>

    <!-- ======= Navbar ======= -->
    <div class="collapse navbar-collapse custom-navmenu" id="main-navbar">
        <div class="container py-2 py-md-5">
            <div class="row align-items-start">
                <div class="col-md-2">
                    <ul class="custom-menu">
                        <li class="active"><a href="index.html">Home</a></li>
                        <li><a href="about.html">About Me</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-6 d-none d-md-block  mr-auto">
                    <div class="row align-items-start">
                        <a href="https://twitter.com/SorianoDev"><span class="bi bi-twitter"></span></a>
                        <a href="https://twitter.com/SorianoDev">SorianoDev</a>
                    </div>
                    <div class="row align-items-start">
                        <a href="https://www.linkedin.com/in/alvaro-soriano-romero-5a75a61b9/"><span class="bi bi-linkedin"></span></a>
                        <a href="https://twitter.com/SorianoDev">Alvaro Soriano Romero</a>
                    </div>
                </div>
                <div class="col-md-4 d-none d-md-block">
                    <h3>Learning by doing</h3>
                    <p>I've always been an advocate that errors and fails make the humans wise. The more you try and research, the more you will learn. What are you waiting for?</p>
                </div>
            </div>

        </div>
    </div>

    <nav class="navbar navbar-light custom-navbar">
        <div class="container">
            <a class="navbar-brand" href="index.html">MyPortfolio.</a>
            <a href="#" class="burger" data-bs-toggle="collapse" data-bs-target="#main-navbar">
                <span></span>
            </a>
        </div>
    </nav>

    <main id="main">

        <section class="section">
            <div class="container">
                <div class="row mb-4 align-items-center">
                    <div class="col-md-6" data-aos="fade-up">
                        <h2>METRO ENGINE</h2>
                        <p>[PC &amp; Playstation 4] C++ Graphics Engine</p>
                    </div>
                </div>
            </div>

            <div class="site-section pb-0">
                <div class="container">
                    <div class="row align-items-stretch">
                        <div class="col-md-8">
                            <div data-aos="fade-up">
                                <video autoplay loop muted playsinline class="img-fluid">
                                    <source src="img/sofa_gif.webm" type="video/webm">
                                    <source src="img/sofa_gif.mp4" type="video/mp4">
                                </video>
                                <!--<img src="img/sofa_gif.gif" alt="Metro engine" class="img-fluid">-->
                            </div>
                            <div data-aos="fade-up" style="align-content:center;">
                                <p><b>PC FOOTAGE</b></p>
                            </div>
                        </div>
                        <div class="col-md-3 ml-auto" data-aos="fade-up" data-aos-delay="100">
                            <div class="sticky-content">
                                <h3 class="h3">Metro Engine</h3>
                                <p class="mb-4"><span class="text-muted">Graphics Programming</span></p>

                                <div class="mb-5">
                                    <p>
                                        The engine was developed by <a href="https://twitter.com/mandev_ivan">Ivan Ivanov Mandev</a> and me during our last year
                                        of an HND in Computing, for the Engine Programming subject. (8 months. October 2020 - May 2021)
                                    </p>

                                </div>

                                <h4 class="h4 mb-3">What I did</h4>
                                <ul class="list-unstyled list-line mb-5">
                                    <li>Multithreading producer-consumer pattern implementation.</li>
                                    <li>Simplified Entity Component System design.</li>
                                    <li>Deferred rendering.</li>
                                    <li>OBJ Loading (sub-geometries and diferent materials in the same object)</li>
                                    <li>Normal Mapping &amp; Parallax Occlusion Mapping</li>
                                    <li>Shadow Mapping</li>
                                    <li>Image Based Lighting</li>
                                    <li>Port to Playstation 4</li>
                                </ul>
                                <div class="row">

                                    <p class="col"><a href="https://metro-engine.github.io/" class="readmore">Visit Website</a></p>
                                    <p class="col"><a href="https://youtu.be/hyn8OK1Co_Y" class="readmore">View Teaser</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <br />
            <div class="site-section pb-0">
                <div class="container" data-aos="fade-up">
                    <p>
                        It was initially conceptualized for PC, using OpenGL as its rendering API, but later our College offered us the posibility of working with
                        a <b>Playstation 4</b> development kit so we decided to port the engine to this platform.</br></br>
                        Metro Engine's features like <b>Physically Based Rendering</b>, <b>ImGui's implementation and Design</b> or <b>LUA implementation</b> (and so on) are not listed above
                        because, although Ivan and I helped each other with everything, we divided the work.</br>
                        <b>
                            Note: Imaged Based Lighting is the only feature that IS NOT IMPLEMENTED in Metro Engine's Playstation Version, aside that,
                            they are identical.
                        </b>
                        </br></br>
                        Once the project ended I started to research Global Illumination myself, until I found
                        <a href="https://morgan3d.github.io/articles/2019-04-01-ddgi/">Morgan McGuire's blog about Dynamic Diffuse Global Illumination</a>
                        (DDGI) and <a href="https://www.gdcvault.com/play/1026182/">his talk at GDC 2019</a>. I fell in love with this technique and started
                        working on getting it working on Metro Engine's PC version. <b><a href="#ddgi">See DDGI section for more!</a></b>
                    </p>
                </div>
            </div>
            <div class="site-section pb-0">
                <div class="container" data-aos="fade-up">
                    <h3>Deferred Rendering</h3>
                    <p>
                        Deferred Rendering is used to avoid calculate the lighting of the scene per object and process it per pixel on the screen. For that
                        we must store first all the information in different textures (usually called G-Buffers) and then take those textures to calculate
                        the light influence in the scene.</br>
                        Here's a Playstation 4 footage of our Engine showing exactly that (the scene lightened, normals of all objects in the scene).
                    </p>
                </div>
            </div>
            <div class="site-section pb-0">
                <div class="container" data-aos="fade-up">
                    <div class="row align-items-stretch">
                        <div class="col-md-6">
                            <video autoplay loop muted playsinline class="img-fluid">
                                <source src="img/ps4_showcase.webm" type="video/webm">
                                <source src="img/ps4_showcase.mp4" type="video/mp4">
                            </video>
                            <!--<img src="img/ps4_showcase.gif" alt="Metro engine" class="img-fluid">-->
                            <div style="align-content:center;">
                                <p><b>PLAYSTATION 4 FOOTAGES</b></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <video autoplay loop muted playsinline class="img-fluid">
                                <source src="img/ps4_showcase_normal.webm" type="video/webm">
                                <source src="img/ps4_showcase_normal.mp4" type="video/mp4">
                            </video>
                            <!--<img src="img/ps4_showcase_normal.gif" alt="Metro engine" class="img-fluid">-->
                        </div>

                    </div>
                </div>
            </div>
            <div class="site-section pb-0">
                <div id="ddgi" class="container" data-aos="fade-up">
                    <h3>Dynamic Diffuse Global Illumination</h3>
                    DDGI uses a mixed solution between GPU and CPU calculations to make indirect lighting influence processing asyncronous and independent.
                    Let's talk about this more.<br /><br />
                    <h4>Technique Overview</h4>
                    <p>
                        This technique is another aproximation to achieve Real Time Global Illumination, and its closely related (and based) to
                        <b>
                            <a href="https://cescg.org/wp-content/uploads/2019/03/Sedlacek-Real-time-Global-Illumination-using-Irradiance-Probes.pdf">
                                Real-time Global Illumination using Irradiance Probes
                            </a>
                        </b>.
                        <br /><br />
                        In our standard Deferred Rendering <b>light pass</b> we receive textures with world position and world normal scene
                        info (just as example) and with that and a PBR algorithm we can calculate the direct lighting of the scene, which is
                        perfectly sustainable at runtime (no heavy calculations). But if we had to calculate light bounces there... real time
                        would only be a dream. The answer here is receiving another texture with the scene <b>indirect lighting</b> already
                        calculated and add it to the direct lighting output we would have in a normal scenario. I know your next question: Where does
                        that indirect lighting come from? From a <b>texture atlas</b> containing the radiance info of the scene probes stored in static memory.
                        Until know this is more or less the same as the <b>Real-time Global Illumination using Irradiance Probes</b> technique but DDGI is
                        different: to avoid light leaks (common in the mentioned approach) McGuire explains a <b>Visibility factor</b> that uses when
                        adding the indirect lighting in the standard deferred light pass to know if there is a wall or something between the selected
                        probe and the point we are calculating light on. Also DDGI uses hardware accelerated Ray-Tracing (that can run without RTX if
                        we develop a BVH traversal algorithm in GPU).
                        <br /><br />
                        That atlas with all the indirect lighting info of the scene that we need to enlighten it is updated <b>when GPU ends its calculations</b>,
                        and that is the very concrete point of why this technique is extremmely powerful, we do <b>NOT</b> have to wait for the indirect lighting info to
                        be processed, we just have to read the atlas and when the next update of the info is ready the atlas will be updated. This is a completely
                        asynchronous approach and as we can choose how often indirect lightning is re-calculated this technique is also potentially adaptable to
                        hardware limitations.
                    </p><br />
                    <h4>GPU probes processing details</h4>
                    <p>
                        From now on I will be talking of how I implemented this technique in our Engine, that uses OpenGL as the rendering backend.
                        As it is my first iteration on this technique and my first implementation of a truely advanced illumination technique
                        all comments and advices are received with a big smile to continue learning! :)<br />
                        First of all we need to place points in the world that will be named <b>probes</b>. For debugging purposes I recommend to implement
                        instanced rendering in your environment and draw spheres on those points (this way we know what is happening all the time).
                        Also using a well known OBJ like Crytek Sponza helps (we can see examples of how this model look everywhere so comparing
                        with our results will easily reveal if there are artifacts).<br /><br />
                        Once I had my probes y created a compute shader and passed to it the array of positions in a Uniform Block (UBO).
                        Then, I asked myself: how can I obtain a 360 degrees photo of the scene? (because that's what we need for each probe).
                        Making a cubemap of each probe seems crazy to me, even doing it in a single Draw Call with <b>Geometry Shaders</b>, so I followed
                        McGuire's advices and went for GPU accelerated Ray Tracing. I needed all the scene objects' info in the shader to ray trace the scene
                        so I built the BVHs of the scene objects easily using <a href="https://github.com/lighttransport/nanort">NanoRT</a>,(I personally recommend this
                        library, it's lightweight and single-header). <br />For those who are not used to work with Ray Tracing, Bound Volume Hierarchies (BVH) are used to divide the space in an optimal way. If we have two objects in the scene, with a normal
                        Ray Tracing approach we would need to check each of both models triangles (that can be literally millions of tris) but with a BVH divided scene
                        we throw a ray and check if we hit the cubes that contain the object; if we did not, then we have saved a million traces.
                        See
                        <b><a href="https://github.com/lighttransport/nanort">these books written by Peter Shirley</a></b>, we explains this in-depth and better than me.

                    </p>
                </div>
                <div class="container">
                    <div class="row align-items-stretch">
                        <div class="col-md-5 ml-auto" data-aos="fade-up" data-aos-delay="100">
                            <div class="sticky-content">
                                <p>
                                    After having all the information ready, I sent it to GPU using Shader Storage Buffer Objects (SSBOs) and then implemented a BVH ray traversal
                                    approach based on NanoRT's way of doing it.<br />
                                    The first I obtained at trying to draw surface normals successfully (with some artifacts) was this:
                                </p>
                            </div>
                        </div>
                        <div class="col-md-7">
                            <div data-aos="fade-up">
                                <video autoplay loop muted playsinline class="img-fluid">
                                    <source src="img/first_raytracing.webm" type="video/webm">
                                    <source src="img/first_raytracing.mp4" type="video/mp4">
                                </video>
                                <!--<img src="img/first_raytracing.gif" alt="First GPU Ray Tracing results." class="img-fluid">-->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container" data-aos="fade-up">
                    <p>[WIP]</p>
                </div>
            </div>
        </section>


    </main><!-- End #main -->
                                <!-- ======= Footer ======= -->
                                <footer class="footer" role="contentinfo">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <p class="mb-1">&copy; Copyright Alvaro Soriano Romero. All Rights Reserved</p>
                                                <div class="credits">
                                                    <!--
                            All the links in the footer should remain intact.
                            You can delete the links only if you purchased the pro version.
                            Licensing information: https://bootstrapmade.com/license/
                            Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/buy/?theme=MyPortfolio
                        -->
                                                    Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
                                                </div>
                                            </div>
                                            <div class="col-sm-6 social text-md-end">
                                                <a href="https://twitter.com/SorianoDev"><span class="bi bi-twitter"></span></a>
                                                <a href="https://www.linkedin.com/in/alvaro-soriano-romero-5a75a61b9/"><span class="bi bi-linkedin"></span></a>
                                            </div>
                                        </div>
                                    </div>
                                </footer>

                                <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

                                <!-- Vendor JS Files -->
                                <script src="assets/vendor/aos/aos.js"></script>
                                <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
                                <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
                                <script src="assets/vendor/php-email-form/validate.js"></script>
                                <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

                                <!-- Template Main JS File -->
                                <script src="assets/js/main.js"></script>

</body>

</html>